# AI Front Desk Agent – Implementation Plan

## 1. Objective

Build an **AI-powered Front Desk Agent** that greets customers (voice-first), understands their issues, performs quick triage, answers simple questions, and **issues queue numbers** with escalation to human staff when needed.

Target use case:

- Physical kiosk / tablet / web front desk
- Voice-based interaction (low latency)
- Queue + escalation workflow

---

## 2. Core Capabilities

### Customer-facing

- Voice greeting & conversation (real-time)
- Intent detection & issue classification
- Ask max 1–3 clarifying questions
- Self-service answers for simple issues
- Queue number issuance + ETA display
- Multilingual ready (ID / EN)

### Staff-facing

- Queue dashboard (waiting / called / done)
- Ticket summary generated by AI
- Manual call-next flow

---

## 3. High-Level Architecture (HLD)

### Frontend (UI)

- **Vite + React + TypeScript**
- Kiosk-style UI
- WebSocket connection to backend
- Mic capture + audio playback
- Displays transcript, agent response, queue number, ETA

### Backend Services

1. **Streaming Agent Service**

   - ADK Streaming
   - Gemini 2.5 Flash Live (native audio)
   - Manages conversation state
   - Decides: self-service vs escalation

2. **MCP Toolbox Service**

   - Implements database-backed tools
   - Secure DB access (agent never sees credentials)
   - Tools exposed via MCP protocol

3. **Queue / Data Layer**

   - PostgreSQL (Cloud SQL / AlloyDB)
   - Stores sessions, intakes, queue tickets

4. **(Optional) CRM Adapter**

   - Zendesk / Freshdesk / internal ticketing

---

## 4. Model & AI Stack

- **Model**: Gemini 2.5 Flash Live (native audio)
- **Mode**: Bidirectional streaming (voice in / voice out)
- **Framework**: Google ADK (Streaming)
- **Tooling**: MCP Toolbox (genai-toolbox)

Agent responsibilities:

- Triage & classification
- Tool calling (queue creation, status)
- Generate staff handoff summary

---

## 5. MCP Toolbox (Tools Design)

Tools implemented via `tools.yaml`:

1. `create_queue_ticket`

   - Input: category, priority, name?, phone?
   - Output: queueNo, etaMinutes, ticketId

2. `get_queue_status`

   - Input: queueNo
   - Output: position, status, etaMinutes

3. `call_next_ticket` (staff side)

   - Input: counterId, category?
   - Output: queueNo, ticketId

Toolbox connects directly to Postgres and is consumed by ADK via MCP.

---

## 6. Frontend–Backend Contract (WebSocket)

### UI → Backend

```json
{ "type": "session.start", "language": "id" }
{ "type": "audio.chunk", "format": "pcm16", "sampleRate": 16000, "dataB64": "..." }
{ "type": "session.stop" }
```

### Backend → UI

```json
{ "type": "asr.partial", "text": "..." }
{ "type": "asr.final", "text": "..." }
{ "type": "agent.text", "text": "..." }
{ "type": "agent.audio", "format": "pcm16", "sampleRate": 24000, "dataB64": "..." }
{ "type": "queue.issued", "queueNo": "A-014", "etaMinutes": 12 }
```

---

## 7. UI Structure (Vite React TS)

```
src/
  app/
    App.tsx
  features/
    frontdesk/
      components/
        MicButton.tsx
        TranscriptPanel.tsx
        QueueCard.tsx
      hooks/
        useVoiceSession.ts
  shared/
    audio/
      micCapture.ts
      pcmPlayer.ts
    ws/
      createWsClient.ts
```

---

## 8. Queue Logic

- Queue number format: `<CATEGORY>-<DAILY_SEQ>` (e.g., A-014)
- Priority levels:

  - P0: urgent / VIP
  - P1: normal
  - P2: scheduled

ETA calculation based on:

- People ahead
- Average handling time per category
- Active counters

---

## 9. Data Model (Minimal)

- `sessions`
- `intakes`
- `queue_tickets`
- `handoff_notes`

PII is optional and consent-based.

---

## 10. Deployment Plan (GCP)

- **Cloud Run**

  - `frontdesk-agent` (ADK Streaming)
  - `mcp-toolbox`

- **Cloud SQL / AlloyDB** (Postgres)
- **VPC / IAM** for secure DB access

---

## 11. MVP Scope

Phase 1 (MVP):

- Voice-based intake
- Queue issuance
- Staff dashboard (basic)

Phase 2:

- Knowledge base (RAG)
- CRM integration
- Analytics & reporting
- Multi-language tuning

---

## 12. Key Design Principles

- Voice-first, low latency
- Human escalation always available
- Minimal questions, fast flow
- Secure-by-design (toolbox, no DB creds in agent)
- Modular & scalable architecture

---

## 13. Success Criteria

- < 2s perceived response latency
- Queue creation success rate > 99%
- Reduced front-desk handling time
- Clear, actionable summaries for staff

---

## 14. Project Structure (Monorepo)

```
frontdesk-ai/
  README.md
  plan.md

  documentation/
    hld.md
    api-contract.md
    prompts.md
    runbook.md
    diagrams/
      hld.mmd

  sql/
    schema/
      001_init.sql
      002_queue.sql
    seeds/
      001_seed_categories.sql

  ai-agent/
    README.md
    src/
      main.py
      agents/
        frontdesk_agent.py
      prompts/
        system.md
        triage.md
      tools/
        mcp_toolbox_client.py

  mcp-toolbox/
    tools.yaml
    docker/
      Dockerfile

  ui-agent/
    vite.config.ts
    index.html
    src/
      app/
      features/
      shared/

  infra/
    cloudrun/
    scripts/
```

---

## 15. Reference Links

### AI / Agent Framework

- Google ADK (Agent Development Kit): [https://google.github.io/adk-docs/](https://google.github.io/adk-docs/)
- ADK Streaming (Live / Bidirectional): [https://google.github.io/adk-docs/streaming/](https://google.github.io/adk-docs/streaming/)

### Models

- Gemini 2.5 Flash (Live / Native Audio): [https://ai.google.dev/gemini-api/docs/models](https://ai.google.dev/gemini-api/docs/models)

### Tooling & MCP

- MCP Toolbox (genai-toolbox): [https://googleapis.github.io/genai-toolbox/](https://googleapis.github.io/genai-toolbox/)
- Model Context Protocol (MCP): [https://modelcontextprotocol.io/](https://modelcontextprotocol.io/)

### Frontend

- Vite: [https://vite.dev/guide/](https://vite.dev/guide/)
- React: [https://react.dev/](https://react.dev/)
- TypeScript: [https://www.typescriptlang.org/docs/](https://www.typescriptlang.org/docs/)

### Audio / Realtime (Web)

- Web Audio API: [https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
- MediaRecorder API: [https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder](https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder)

### Backend & Infra (GCP)

- Cloud Run: [https://cloud.google.com/run/docs](https://cloud.google.com/run/docs)
- Cloud SQL (PostgreSQL): [https://cloud.google.com/sql/docs/postgres](https://cloud.google.com/sql/docs/postgres)
- Vertex AI Gemini: [https://cloud.google.com/vertex-ai/docs/generative-ai](https://cloud.google.com/vertex-ai/docs/generative-ai)
